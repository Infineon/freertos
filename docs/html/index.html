<!-- HTML header for doxygen 1.8.13-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>(FreeRTOS)</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen_style.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><a href="http://www.cypress.com/"><img alt="Logo" src="logo.png"/></a></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">(FreeRTOS)</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('index.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">FreeRTOS for Infineon MCUs - Overview </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="section_introduction"></a>
Introduction</h1>
<p >FreeRTOS is supplied as standard C source files built along with the other C files in your project. This repository contains a port of FreeRTOS kernel for Infineon MCUs based on Arm&reg; Cortex&reg;-M0 (CM0), Cortex&reg;-M0+ (CM0P), Cortex&reg;-M4 (CM4), Cortex&reg;-M33 (CM33), Cortex&reg;-M55 (CM55), Cortex&reg;-R4 (CR4) and Cortex&reg;-M7 (CM7) cores. </p><dl class="section note"><dt>Note</dt><dd>Cortex&reg; R4 (CR4) is currently supported only on GCC_ARM</dd></dl>
<p>Additional information about using this library in ModusToolbox&trade; software including a <a href="https://github.com/Infineon/freertos/blob/master/README.md#quick-start">Quick Start</a> guide can be found in the library's <a href="https://github.com/Infineon/freertos/blob/master/README.md">README.md</a> file.</p>
<h1><a class="anchor" id="section_freertos_quick_start"></a>
Quick Start Guide</h1>
<h2><a class="anchor" id="subsection_freertos_ntz_flow"></a>
FreeRTOS default flow (non TrustZone)</h2>
<h3><a class="anchor" id="subsubsection_freertos_ntz_description"></a>
Description</h3>
<p >The quick start guide provides steps to create a simple blinking LED project with a single task using FreeRTOS.</p>
<h3><a class="anchor" id="subsubsection_freertos_ntz_s1"></a>
STEP1: Projects preparation.</h3>
<ol type="1">
<li>Create a ModusToolbox&trade; application.</li>
<li>Include the FreeRTOS middleware into the project using the ModusToolbox&trade; Library Manager. <dl class="section note"><dt>Note</dt><dd>ModusToolbox&trade; library manager automatically pulls the dependent libraries (clib-support, abstraction-rtos) once the FreeRTOS library is selected.</dd></dl>
</li>
<li>Add <code>FREERTOS</code> to the <code>COMPONENTS</code> variable defined in the ModusToolbox&trade; application Makefile: <div class="fragment"><div class="line">COMPONENTS += FREERTOS </div>
</div><!-- fragment --></li>
<li>Copy the <em>FreeRTOSConfig.h</em> file from the **mtb_shared/freertos/release-vX.Y.Z/Source/portable/COMPONENT_(CORE)* folder to your project, where (CORE) is the target Arm&reg; Cortex&reg;-M CPU core (CM0, CM0P, CM4, CM33, CM55, CR4 or CM7).</li>
<li>Open the copied <em>FreeRTOSConfig.h</em> file and remove the <code>#warning This is a template.</code> line. See <a href="https://github.com/Infineon/freertos/blob/master/README.md#configuration-considerations">Configuration Consideration</a> section of the README.md file. <dl class="section warning"><dt>Warning</dt><dd>Ensure that configENABLE_TRUSTZONE is set to 0 and configRUN_FREERTOS_SECURE_ONLY to 1 in case if you run on secure core only configuration like for PSOC Control C3 MCU devices</dd></dl>
</li>
</ol>
<h3><a class="anchor" id="subsubsection_freertos_ntz_s2"></a>
STEP2: Project sources update.</h3>
<ol type="1">
<li>Include the required headers. <div class="fragment"><div class="line"><span class="preprocessor">#include &quot;FreeRTOS.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;task.h&quot;</span></div>
</div><!-- fragment --></li>
<li>Specify LED port and other defines. <div class="fragment"><div class="line"><span class="preprocessor">#define BLINKY_TASK_NAME            (&quot;Blinky&quot;</span>)</div>
<div class="line"><span class="preprocessor">#define BLINKY_TASK_STACK_SIZE      (configMINIMAL_STACK_SIZE)</span></div>
<div class="line"><span class="preprocessor">#define BLINKY_TASK_PRIORITY        (tskIDLE_PRIORITY + 1)</span></div>
<div class="line"><span class="preprocessor">#define USER_LED_TOGGLE_PERIOD_MS   100u</span></div>
<div class="line"><span class="preprocessor">#define LED_GPIO    (CYBSP_USER_LED)</span></div>
</div><!-- fragment --></li>
<li>Create function to toggle the LED. <div class="fragment"><div class="line"><span class="keywordtype">void</span> blinky_task(<span class="keywordtype">void</span> * arg)</div>
<div class="line">{</div>
<div class="line">    (void) arg;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span>(;;)</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">/* Toggle the LED periodically */</span></div>
<div class="line">        Cy_GPIO_Inv(CYBSP_USER_LED_PORT, CYBSP_USER_LED_PIN);</div>
<div class="line">        vTaskDelay(USER_LED_TOGGLE_PERIOD_MS);</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --></li>
<li>Create task for LED toggling and start scheduler. <div class="fragment"><div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    BaseType_t retval;</div>
<div class="line">    cy_rslt_t result;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Initialize the device and board peripherals */</span></div>
<div class="line">    result = cybsp_init() ;</div>
<div class="line">    <span class="keywordflow">if</span> (result != CY_RSLT_SUCCESS)</div>
<div class="line">    {</div>
<div class="line">        CY_ASSERT(0);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    __enable_irq();</div>
<div class="line"> </div>
<div class="line">    retval = xTaskCreate(blinky_task, BLINKY_TASK_NAME, BLINKY_TASK_STACK_SIZE, NULL, BLINKY_TASK_PRIORITY, NULL );</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (pdPASS == retval)</div>
<div class="line">    {</div>
<div class="line">        vTaskStartScheduler();</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (;;)</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">/* vTaskStartScheduler never returns */</span></div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --></li>
</ol>
<h3><a class="anchor" id="subsubsection_freertos_ntz_s3"></a>
STEP3: Build and Program Application.</h3>
<ul>
<li>Observe the LED blinking on the kit.</li>
</ul>
<h2><a class="anchor" id="subsection_freertos_tz_flow"></a>
FreeRTOS with TrustZone (only CM33 core) flow</h2>
<h3><a class="anchor" id="subsubsection_freertos_tz_description"></a>
Description</h3>
<p >ARM&reg; introduced TrustZone to the Cortex-M&reg; series of microcontrollers with the ARMv8-M architecture. TrustZone is an security extension that enables two security domains within a single processor. The quick start guide provides steps to create a simple application (consist of two independent projects - Secure and nonSecure). FreeRTOS run on nonSecure-side application with two tasks, witch will be calling Secure-side APIs to get data from Secure project.</p>
<h3><a class="anchor" id="subsubsection_freertos_tz_s1"></a>
STEP1: Create a ModusToolboxâ„¢ application.</h3>
<p >Create a ModusToolbox&trade; PSoC Edge <code>PSOC_Edge_Hello_World</code> application for <code>KIT_PSE84_EVAL_EPC2</code>.</p>
<h3><a class="anchor" id="subsubsection_freertos_tz_s2"></a>
STEP2: nonSecure project source update.</h3>
<ol type="1">
<li>Include the FreeRTOS and Retarget_IO (could be already added) middleware using the ModusToolbox&trade; Library Manager.</li>
<li>Copy the <em>FreeRTOSConfig.h</em> file from the <em>mtb_shared/freertos/release-vX.Y.Z/Source/portable/COMPONENT_CM33</em> folder to your <b>nonSecure</b> project root.</li>
<li>Open the copied <em>FreeRTOSConfig.h</em> file and remove the <code>#warning This is a template.</code> line.</li>
<li>Add <code>FREERTOS</code> and <code>FREERTOS_TZ</code> to the <code>COMPONENTS</code> variable defined in the ModusToolbox&trade; <b>nonSecure</b> application Makefile: <div class="fragment"><div class="line">COMPONENTS += FREERTOS FREERTOS_TZ</div>
</div><!-- fragment --></li>
<li>Include the required headers in the main.c. <div class="fragment"><div class="line"><span class="preprocessor">#include &quot;FreeRTOS.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;task.h&quot;</span></div>
</div><!-- fragment --></li>
<li>Specify tasks defines. <div class="fragment"><div class="line"><span class="preprocessor">#define FIRST_TASK_NAME             (&quot;First&quot;</span>)</div>
<div class="line"><span class="preprocessor">#define FIRST_TASK_STACK_SIZE       4096</span></div>
<div class="line"><span class="preprocessor">#define FIRST_TASK_PRIORITY         1</span></div>
<div class="line"><span class="preprocessor">#define FIRST_TASK_DELAY            300</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define SECOND_TASK_NAME            (&quot;Second&quot;</span>)</div>
<div class="line"><span class="preprocessor">#define SECOND_TASK_STACK_SIZE      4096</span></div>
<div class="line"><span class="preprocessor">#define SECOND_TASK_PRIORITY        1</span></div>
<div class="line"><span class="preprocessor">#define SECOND_TASK_DELAY           700</span></div>
</div><!-- fragment --></li>
<li>Specify initial variable values. <div class="fragment"><div class="line"><span class="keywordtype">int</span> first_val = 0;</div>
<div class="line"><span class="keywordtype">int</span> second_val = 3;</div>
</div><!-- fragment --></li>
<li>Define function from Secure project. <div class="fragment"><div class="line"><span class="keywordtype">int</span> nsc_1_func(<span class="keywordtype">int</span> value);</div>
<div class="line"><span class="keywordtype">int</span> nsc_2_func(<span class="keywordtype">int</span> value);</div>
</div><!-- fragment --></li>
<li>Create two independent functions with different NSC API calls. <div class="fragment"><div class="line"><span class="keywordtype">void</span> first_task(<span class="keywordtype">void</span> *pvParameters)</div>
<div class="line">{</div>
<div class="line">    (void) pvParameters;</div>
<div class="line">    portALLOCATE_SECURE_CONTEXT( configMINIMAL_SECURE_STACK_SIZE );</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span>(;;)</div>
<div class="line">    {</div>
<div class="line"> </div>
<div class="line">        vTaskDelay(FIRST_TASK_DELAY);</div>
<div class="line"> </div>
<div class="line">        first_val = nsc_1_func(first_val);</div>
<div class="line"> </div>
<div class="line">        printf(<span class="stringliteral">&quot;First veneer -&gt; %d!\r\n&quot;</span>, first_val);</div>
<div class="line"> </div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> second_task(<span class="keywordtype">void</span> *pvParameters)</div>
<div class="line">{</div>
<div class="line">    (void) pvParameters;</div>
<div class="line">    portALLOCATE_SECURE_CONTEXT( configMINIMAL_SECURE_STACK_SIZE );</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span>(;;)</div>
<div class="line">    {</div>
<div class="line"> </div>
<div class="line">        vTaskDelay(SECOND_TASK_DELAY);</div>
<div class="line"> </div>
<div class="line">        second_val = nsc_2_func(second_val);</div>
<div class="line">        printf(<span class="stringliteral">&quot;Second veneer -&gt; %d!\r\n&quot;</span>, second_val);</div>
<div class="line"> </div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --> <dl class="section note"><dt>Note</dt><dd><code>portALLOCATE_SECURE_CONTEXT( configMINIMAL_SECURE_STACK_SIZE );</code> will create Secure stack for nonSecure task with NSC call. Need to be added in ech task.</dd></dl>
</li>
<li>Create two tasks and start scheduler. <div class="fragment"><div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line"> </div>
<div class="line">    cy_rslt_t result;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Initialize the device and board peripherals */</span></div>
<div class="line">    result = cybsp_init() ;</div>
<div class="line">    <span class="keywordflow">if</span> (result != CY_RSLT_SUCCESS)</div>
<div class="line">    {</div>
<div class="line">        CY_ASSERT(0);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    __enable_irq();</div>
<div class="line"> </div>
<div class="line">    init_retarget_io(); </div>
<div class="line"> </div>
<div class="line">    result = xTaskCreate(first_task, FIRST_TASK_NAME, FIRST_TASK_STACK_SIZE, NULL, FIRST_TASK_PRIORITY, NULL );</div>
<div class="line">    <span class="keywordflow">if</span> (result != pdPASS)</div>
<div class="line">    {</div>
<div class="line">        CY_ASSERT(0);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    result = xTaskCreate(second_task, SECOND_TASK_NAME, SECOND_TASK_STACK_SIZE, NULL, SECOND_TASK_PRIORITY, NULL );</div>
<div class="line">    <span class="keywordflow">if</span> (result != pdPASS)</div>
<div class="line">    {</div>
<div class="line">        CY_ASSERT(0);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    vTaskStartScheduler();</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (;;)</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">/* vTaskStartScheduler never returns */</span></div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --> <dl class="section note"><dt>Note</dt><dd>Task creation could be added before main loop and call of the Cy_SysEnableCM55</dd></dl>
</li>
</ol>
<h3><a class="anchor" id="subsubsection_freertos_tz_s3"></a>
STEP3: Secure project source update.</h3>
<ol type="1">
<li>Copy the <em>mtb_shared/freertos/release-vX.Y.Z/Source/COMPONENT_FREERTOS_TZ/COMPONENT_SECURE_DEVICE/TOOLCHAIN_xxx</em> folder into your <b>Secure</b> project root.</li>
<li>Copy the <em>FreeRTOSConfig.h</em> file from the <em>mtb_shared/freertos/release-vX.Y.Z/Source/portable/COMPONENT_CM33</em> folder to your <b>Secure</b> project root.</li>
<li>Open the copied <em>FreeRTOSConfig.h</em> file and remove the <code>#warning This is a template.</code> line. See <a href="https://github.com/Infineon/freertos/blob/master/README.md#configuration-considerations">Configuration Consideration</a> section of the README.md file.</li>
<li>Create two functions with NSC Secure_attributes <div class="fragment"><div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> __attribute__((cmse_nonsecure_entry)) nsc_1_func(<span class="keywordtype">int</span> value)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">return</span> value + 3; <span class="comment">// Returns input + 5</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> __attribute__((cmse_nonsecure_entry)) nsc_2_func(<span class="keywordtype">int</span> value)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">return</span> value * 2; <span class="comment">// Returns input * 3</span></div>
<div class="line">}</div>
</div><!-- fragment --> </li>
</ol>
<h3><a class="anchor" id="subsubsection_freertos_tz_s4"></a>
STEP4: Build and Program Application.</h3>
<ul>
<li>Observe the async digits from the kit UART output in any COM-port terminal.</li>
</ul>
<h1><a class="anchor" id="section_FreeRTOS_API_Reference"></a>
FreeRTOS API reference</h1>
<p >See <a href="https://www.freertos.org/a00106.html">FreeRTOS API reference</a></p>
<h1><a class="anchor" id="group_dfu_more_info"></a>
More Information</h1>
<p >For more information, refer to the links in the <a href="https://github.com/Infineon/freertos/blob/master/README.md#more-information">README.md</a> </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part
<div id="nav-path" class="navpath">
    <ul>
        <li class="footer">
            Generated for <b>(FreeRTOS)</b> by <b>Cypress Semiconductor Corporation</b>.
            All rights reserved.
        </li>
    </ul>
</div>
-->
</body>
</html>
